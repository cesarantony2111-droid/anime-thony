<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitio de Anime</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
</head>
<body>
<!--------Barra de navegación-------->
    <header class="home" id="home">
        <a href="#" class="logo">
            <i class='bx bxs-movie'></i> Anime
        </a>
        <div class="bx bx-menu" id="menu-icon"></div>
    
    <!-----Menú------>
        <ul class="navbar">
            <li><a href="#home">Inicio</a></li>
            <li><a href="#movies">Series</a></li>
            <li><a href="#coming">Próximamente</a></li>
            
        <!-- Botón Admin oculto - solo se ve si sabes la contraseña -->
<div id="admin-btn-container" style="display:none;">
    <a href="#" class="btn" id="admin-btn">Admin</a>
</div>

<!-- Input secreto para activar el botón Admin (presiona Ctrl + Shift + A o escribe "admin123") -->
<script>
// Activar botón admin con combinación secreta o contraseña
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'A') {
        document.getElementById('admin-btn-container').style.display = 'block';
    }
});
// O también puedes escribir "admin123" en cualquier parte y presionas Enter
let code = '';
document.addEventListener('keydown', function(e) {
    code += e.key;
    if (code.includes('admin123')) {
        document.getElementById('admin-btn-container').style.display = 'block';
        code = '';
    }
    if (code.length > 10) code = '';
});
</script>
        </ul>
    </header>

    <section class="home swiper" id="home">
        <div class="swiper-wrapper">
            <div class="swiper-slide container">
                <img src="./images/home1.png" alt="Naruto Shippuden">
                <div class="home-text">
                    <span>UNIVERSO PIERROT</span>
                    <h1>Naruto:</h1><h1>Shippuden</h1>
                    <a href="#" class="btn">Descargar ahora</a>
                    <a href="#" class="play">
                        <i class='bx bx-play'></i>
                    </a>
                </div>
            </div>
            <!--box-img-2-->
            <div class="swiper-slide container">
                <img src="./images/home2.jpg" alt="One Piece">
                <div class="home-text">
                    <span>UNIVERSO TOEI</span>
                    <h1>One Piece</h1>
                    <a href="#" class="btn">Descargar ahora</a>
                    <a href="#" class="play">
                        <i class='bx bx-play'></i>
                    </a>
                </div>
            </div>
            <!--box-img-3-->
            <div class="swiper-slide container">
                <img src="./images/home3.jpg" alt="Dragon Ball">
                <div class="home-text">
                    <span>UNIVERSO TOEI</span>
                    <h1>Dragon Ball</h1>
                    <a href="#" class="btn">Descargar ahora</a>
                    <a href="#" class="play">
                        <i class="bx bx-play"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="swiper-pagination"></div>
    </section>

    <!-- Series populares -->
    <section class="movies" id="movies">
        <h2 class="heading">También te puede gustar</h2>
        <div class="movies-container">
        <!--------Caja 1----------->
            <div class="box">
                <div class="box-image">
                    <img src="./images/p1.jpg" alt="Attack on Titan">
                </div>
                <h3>Attack on Titan</h3>
                <span>23 min | Acción / Fantasía</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p2.png" alt="One Punch Man">
                </div>
                <h3>One Punch Man</h3>
                <span>23 min | Acción / Comedia</span>
            </div>
            <div class="box"> 
                <div class="box-image">
                    <img src="./images/p3.png" alt="Jujutsu Kaisen">
                </div>
                <h3>Jujutsu Kaisen</h3>
                <span>23 min | Acción / Fantasía</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p4.jpg" alt="Hunter x Hunter">
                </div>
                <h3>Hunter x Hunter</h3>
                <span>23 min | Aventura / Acción</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p5.png" alt="Death Note">
                </div>
                <h3>Death Note</h3>
                <span>23 min | Suspenso / Psicológico</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p6.jpg" alt="One Piece">
                </div>
                <h3>One Piece</h3>
                <span>23 min | Aventura</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p7.png" alt="My Hero Academia">
                </div>
                <h3>My Hero Academia</h3>
                <span>23 min | Acción / Superhéroes</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p8.jpg" alt="Demon Slayer">
                </div>
                <h3>Demon Slayer</h3>
                <span>23 min | Acción / Fantasía</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p9.jpg" alt="Code Geass">
                </div>
                <h3>Code Geass</h3>
                <span>23 min | Mecha / Drama</span>
            </div>
            <div class="box">
                <div class="box-image">
                    <img src="./images/p10.png" alt="Chainsaw Man">
                </div>
                <h3>Chainsaw Man</h3>
                <span>23 min | Acción / Gore</span>
            </div>
        </div>
    </section>

    <!-----Próximamente------->
    <section class="coming" id="coming">
        <h2 class="heading">Próximamente</h2>
        <div class="coming-container swiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming1.jpg" alt="Pokemon">
                    </div>
                    <h3>Pokemon</h3>
                    <span>23 min | Aventura</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming2.jpg" alt="Sword Art Online">
                    </div>
                    <h3>Sword Art Online</h3>
                    <span>23 min | Isekai</span>
                </div>
                <div class="swiper-slide box"> 
                    <div class="box-image">
                        <img src="./images/comin3(campfirecooking).jpeg" alt="Campfire Cooking">
                    </div>
                    <h3>Campfire Cooking</h3>
                    <span>23 min | Fantasía / Comida</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming4(mashle magic and muscles).jpg" alt="Mashle">
                    </div>
                    <h3>Mashle: Magia y Músculos</h3>
                    <span>23 min | Comedia / Acción</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming5.jpeg" alt="Good Night World">
                    </div>
                    <h3>Good Night World</h3>
                    <span>23 min | Drama / Sci-Fi</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming6(burningkabaddi).png" alt="Burning Kabaddi">
                    </div>
                    <h3>Burning Kabaddi</h3>
                    <span>23 min | Deportes</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming7(urusei yatsura).jpg" alt="Urusei Yatsura">
                    </div>
                    <h3>Urusei Yatsura</h3>
                    <span>23 min | Comedia / Romance</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming8.jpg" alt="Ayaka">
                    </div>
                    <h3>Ayaka</h3>
                    <span>23 min | Fantasía</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming9.jpeg" alt="Solo Leveling">
                    </div>
                    <h3>Solo Leveling</h3>
                    <span>23 min | Acción / Isekai</span>
                </div>
                <div class="swiper-slide box">
                    <div class="box-image">
                        <img src="./images/coming10.jpg" alt="Takt op.Destiny">
                    </div>
                    <h3>Takt op: Destiny</h3>
                    <span>23 min | Música / Drama</span>
                </div>
            </div>
        </div>
    </section>

    

<!-- Pie de página -->
<section class="footer">
    <a href="#" class="logo">
        <i class='bx bxs-movie'></i> Anime
    </a>
    <div class="social">
        <a href="https://www.youtube.com/feed/you" target="_blank">
            <i class='bx bxl-youtube'></i>
        </a>
        <a href="https://www.instagram.com/itss_thonyx?igsh=NWI2YzY1YjFzMGs2" target="_blank">
            <i class='bx bxl-instagram'></i>
        </a>
        <a href="https://web.facebook.com/profile.php?id=100082574790845" target="_blank">
            <i class='bx bxl-facebook'></i>
        </a>
    </div>
</section>

<div class="copyright">
    <h3>Hecho con mucho amor por Thony</h3>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script src="./index.js"></script>
<!-- PANEL ADMIN DEFINITIVO - Subir imágenes desde PC + Mostrar en página -->
<div id="admin-panel" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:10000; overflow-y:auto; color:white; font-family:Poppins;">
    <div style="max-width:1100px; margin:40px auto; background:#111; padding:30px; border-radius:15px; border:3px solid var(--main-color);">
        <button onclick="closeAdmin()" style="float:right; background:#ff4444; color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-weight:bold; font-size:18px;">
            ✕ Cerrar
        </button>
        <h1 style="text-align:center; color:var(--main-color); margin:30px 0; font-size:2.5rem;">Panel Admin</h1>

        <div id="category-selection">
            <h2 style="text-align:center; margin-bottom:30px;">Elige la sección que quieres editar:</h2>
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:20px;">
                <button onclick="openCategory('populares')" class="cat-btn">Series Populares</button>
                <button onclick="openCategory('proximamente')" class="cat-btn">Próximamente</button>
                <button onclick="openCategory('accion')" class="cat-btn">Acción</button>
                <button onclick="openCategory('isekai')" class="cat-btn">Isekai</button>
                <button onclick="openCategory('romance')" class="cat-btn">Romance</button>
                <button onclick="openCategory('comedia')" class="cat-btn">Comedia</button>
            </div>
        </div>

        <div id="edit-section" style="display:none; margin-top:40px;">
            <button onclick="backToMenu()" style="padding:10px 20px; background:#333; border:none; color:white; border-radius:8px; margin-bottom:20px;">
                ← Volver
            </button>
            <h2 id="section-title" style="color:var(--main-color); text-align:center; font-size:2rem;"></h2>

            <!-- Formulario con subida de imagen local -->
            <div style="background:#222; padding:25px; border-radius:12px; margin:30px 0;">
                <h3>Añadir Nuevo Anime</h3>
                <input type="text" id="anime-title" placeholder="Título del anime" class="admin-input"><br>
                <textarea id="anime-desc" placeholder="Descripción (opcional)" class="admin-input" style="height:90px;"></textarea><br>
                
                <label style="display:block; margin:15px 0 5px; color:#aaa;">Portada del anime (desde tu PC):</label>
                <input type="file" id="anime-image" accept="image/*" style="padding:10px; background:#333; color:white; border-radius:8px; width:100%;">
                <div id="image-preview" style="margin-top:15px; text-align:center;">
                    <img id="preview-img" src="" style="max-width:300px; max-height:400px; border-radius:10px; display:none;">
                </div>

                <button onclick="addAnime()" style="background:var(--main-color); padding:14px 30px; border:none; color:white; border-radius:10px; cursor:pointer; font-weight:bold; margin-top:20px; font-size:1.1rem;">
                    + Añadir a la Página
                </button>
            </div>

            <h3>Animes actuales (<span id="count">0</span>):</h3>
            <div id="anime-list" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:20px; margin-top:20px;"></div>
        </div>
    </div>
</div>

<style>
    .cat-btn {
        padding:25px; background:#222; border:3px solid #444; color:white; font-size:1.3rem;
        border-radius:15px; cursor:pointer; transition:all .3s; font-weight:600;
    }
    .cat-btn:hover { background:var(--main-color); border-color:var(--main-color); transform:scale(1.05); }
    .admin-input { width:100%; padding:14px; margin:12px 0; border-radius:10px; border:none; background:#333; color:white; font-size:1rem; }
</style>

<script>
// Variables
let currentSection = '';

// Abrir/cerrar panel
function closeAdmin() { document.getElementById('admin-panel').style.display = 'none'; }
function backToMenu() {
    document.getElementById('edit-section').style.display = 'none';
    document.getElementById('category-selection').style.display = 'block';
}
function openCategory(section) {
    currentSection = section;
    document.getElementById('category-selection').style.display = 'none';
    document.getElementById('edit-section').style.display = 'block';
    document.getElementById('section-title').textContent = 
        section === 'populares' ? 'Series Populares' :
        section === 'proximamente' ? 'Próximamente' : section.charAt(0).toUpperCase() + section.slice(1);

    loadAnimes();
}

// Previsualizar imagen
document.getElementById('anime-image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById('preview-img');
            img.src = e.target.result;
            img.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
});

// Añadir anime (con imagen local convertida a base64)
function addAnime() {
    const title = document.getElementById('anime-title').value.trim();
    const desc = document.getElementById('anime-desc').value.trim();
    const fileInput = document.getElementById('anime-image');

    if (!title) return alert('El título es obligatorio');

    const reader = new FileReader();
    if (fileInput.files[0]) {
        reader.readAsDataURL(fileInput.files[0]);
        reader.onload = function() {
            saveAnime({ title, desc, image: reader.result });
        };
    } else {
        saveAnime({ title, desc, image: './images/default.jpg' });
    }
}

function saveAnime(anime) {
    let animes = JSON.parse(localStorage.getItem('animes_' + currentSection) || '[]');
    animes.push(anime);
    localStorage.setItem('animes_' + currentSection, JSON.stringify(animes));
    alert('¡Anime agregado!');
    document.getElementById('anime-title').value = '';
    document.getElementById('anime-desc').value = '';
    document.getElementById('anime-image').value = '';
    document.getElementById('preview-img').style.display = 'none';
    loadAnimes();
    updateWebsiteSections();   // ← AQUÍ (importante)
}

function deleteAnime(index) {
    if (confirm('¿Eliminar este anime?')) {
        let animes = JSON.parse(localStorage.getItem('animes_' + currentSection) || '[]');
        animes.splice(index, 1);
        localStorage.setItem('animes_' + currentSection, JSON.stringify(animes));
        loadAnimes();
        updateWebsiteSections();   // ← Y AQUÍ (importante)
    }
}

// Cargar lista en panel admin
function loadAnimes() {
    const list = document.getElementById('anime-list');
    const animes = JSON.parse(localStorage.getItem('animes_' + currentSection) || '[]');
    document.getElementById('count').textContent = animes.length;

    list.innerHTML = animes.map((a, i) => `
        <div style="background:#222; padding:15px; border-radius:12px; text-align:center;">
            <img src="${a.image}" style="width:100%; height:350px; object-fit:cover; border-radius:10px;">
            <h3 style="margin:15px 0; color:var(--main-color);">${a.title}</h3>
            ${a.desc ? `<p style="color:#ccc; font-size:0.9rem;">${a.desc}</p>` : ''}
            <button onclick="deleteAnime(${i})" style="background:#ff4444; color:white; padding:10px 20px; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">
                Eliminar
            </button>
        </div>
    `).join('');
}

function deleteAnime(index) {
    if (confirm('¿Eliminar este anime?')) {
        let animes = JSON.parse(localStorage.getItem('animes_' + currentSection) || '[]');
        animes.splice(index, 1);
        localStorage.setItem('animes_' + currentSection, JSON.stringify(animes));
        loadAnimes();
        updateWebsiteSections();
    }
}

// ABRIR PANEL ADMIN
document.getElementById('admin-btn')?.addEventListener('click', e => {
    e.preventDefault();
    document.getElementById('admin-panel').style.display = 'block';
    backToMenu();
});
</script>
<script>
// === ACTUALIZAR SECCIONES DINÁMICAS CON CARRUSEL Y TAMAÑO PERFECTO ===
function updateWebsiteSections() {
    // 1. PRÓXIMAMENTE → ya funciona perfecto (carrusel completo)

    // 2. SERIES POPULARES → solo añadimos al final (sin borrar los originales)
    const popularesNuevos = JSON.parse(localStorage.getItem('animes_populares') || '[]');
    const containerPopulares = document.querySelector('.movies-container');
    if (containerPopulares && popularesNuevos.length > 0) {
        popularesNuevos.forEach(anime => {
            if ([...containerPopulares.querySelectorAll('h3')].every(h => h.textContent !== anime.title)) {
                const box = document.createElement('div');
                box.className = 'box';
                box.innerHTML = `
                    <div class="box-image">
                        <img src="${anime.image}" alt="${anime.title}">
                    </div>
                    <h3>${anime.title}</h3>
                    <span>23 min | ${anime.desc || 'Anime'}</span>
                `;
                containerPopulares.appendChild(box);
            }
        });
    }

    // 3. CATEGORÍAS PERSONALIZADAS (Acción, Isekai, etc.) → con Swiper y estilo perfecto
    const categorias = ['accion', 'isekai', 'romance', 'comedia', 'drama', 'fantasia', 'shonen'];
    categorias.forEach(cat => {
        const datos = JSON.parse(localStorage.getItem('animes_' + cat) || '[]');
        if (datos.length === 0) return;

        let seccion = document.getElementById('seccion-' + cat);
        
        // Si ya existe, solo actualizamos el contenido
        if (seccion) {
            const wrapper = seccion.querySelector('.swiper-wrapper');
            wrapper.innerHTML = datos.map(a => `
                <div class="swiper-slide">
                    <div class="box">
                        <div class="box-image">
                            <img src="${a.image}" alt="${a.title}">
                        </div>
                        <h3>${a.title}</h3>
                        <span>23 min | ${a.desc || cat.charAt(0).toUpperCase() + cat.slice(1)}</span>
                    </div>
                </div>
            `).join('');
            seccion.querySelector('.swiper').swiper.update();
            return;
        }

        // Crear nueva sección con Swiper
        seccion = document.createElement('section');
        seccion.id = 'seccion-' + cat;
        seccion.className = 'coming';
        seccion.innerHTML = `
            <h2 class="heading">${cat.charAt(0).toUpperCase() + cat.slice(1)}</h2>
            <div class="coming-container swiper">
                <div class="swiper-wrapper">
                    ${datos.map(a => `
                        <div class="swiper-slide">
                            <div class="box">
                                <div class="box-image">
                                    <img src="${a.image}" alt="${a.title}" style="object-fit: cover;">
                                </div>
                                <h3>${a.title}</h3>
                                <span>23 min | ${a.desc || cat.charAt(0).toUpperCase() + cat.slice(1)}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

        // Insertar después de "Próximamente"
        document.querySelector('#coming').insertAdjacentElement('afterend', seccion);

        // Inicializar Swiper para esta nueva categoría
        new Swiper(seccion.querySelector('.swiper'), {
            spaceBetween: 20,
            loop: datos.length > 5,
            autoplay: { delay: 4000, disableOnInteraction: false },
            centeredSlides: true,
            breakpoints: {
                0: { slidesPerView: 2 },
                568: { slidesPerView: 3 },
                768: { slidesPerView: 4 },
                968: { slidesPerView: 5 },
            }
        });
    });
}

// Ejecutar al cargar y después de cada cambio
document.addEventListener('DOMContentLoaded', updateWebsiteSections);

// También ejecutarlo después de añadir/eliminar en el admin
window.updateWebsiteSections = updateWebsiteSections;
</script>
<!-- MODAL CENTRO - GRANDE, ELEGANTE Y SIN BORDES -->
<div id="anime-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.94); backdrop-filter:blur(12px); z-index:9999; align-items:center; justify-content:center; padding:20px; overflow-y:auto;">
    <div style="background:rgba(15,15,15,0.97); max-width:900px; width:100%; border-radius:28px; overflow:hidden; box-shadow:0 20px 60px rgba(255,44,31,0.4); animation:modalIn 0.5s ease forwards; transform:scale(0.9); opacity:0;">
        
        <!-- Imagen grande arriba -->
        <div style="position:relative; height:500px;">
            <img id="modal-img" src="" alt="" style="width:100%; height:100%; object-fit:cover; border-radius:28px 28px 0 0;">
            <div style="position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,0.9), transparent 30%); border-radius:28px 28px 0 0;"></div>
            
            <!-- Botón cerrar -->
            <button onclick="document.getElementById('anime-modal').style.display='none'" 
                    style="position:absolute; top:20px; right:25px; background:rgba(255,255,255,0.2); backdrop-filter:blur(10px); color:white; border:none; width:50px; height:50px; border-radius:50%; font-size:2rem; cursor:pointer; z-index:10;">
                X
            </button>
        </div>

        <!-- Contenido -->
        <div style="padding:40px; color:white;">
            <h1 id="modal-title" style="font-size:3.2rem; margin:0 0 20px 0; color:var(--main-color); text-align:center;"></h1>
            
            <div style="text-align:center; margin-bottom:25px; font-size:1.1rem; color:#ff6b6b;">
                <span id="modal-episodes">24 episodios</span> • 
                <span id="modal-year">2024</span> • 
                <span id="modal-status">En emisión</span>
            </div>

            <p id="modal-desc" style="font-size:1.35rem; line-height:1.8; color:#e0e0e0; margin-bottom:30px; text-align:center; max-width:800px; margin-left:auto; margin-right:auto;"></p>

            <div id="modal-genres" style="text-align:center; margin-bottom:35px;">
                <!-- Los géneros se generan automáticamente -->
            </div>

            <div style="text-align:center;">
                <a href="#" id="modal-link" target="_blank" style="background:var(--main-color); color:white; padding:18px 50px; border-radius:50px; text-decoration:none; font-weight:bold; font-size:1.4rem; display:inline-block; box-shadow:0 8px 25px rgba(255,44,31,0.4);">
                    Ver Ahora
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes modalIn {
        to { transform:scale(1); opacity:1; }
    }
    #anime-modal button:hover {
        background: var(--main-color) !important;
        transform: scale(1.1);
    }
</style>

<script>
// BASE DE DATOS DE ANIME (opcional: solo si quieres enlaces personalizados)
const animeDB = {
    'Jujutsu Kaisen': { link: 'https://www.crunchyroll.com/es/series/GY5P48XEY/jujutsu-kaisen' },
    'Attack on Titan': { link: 'https://www.crunchyroll.com/es/series/GR751KNZY/attack-on-titan' },
    'One Punch Man': { link: 'https://www.crunchyroll.com/es/series/G63V7KN7Y/one-punch-man' },
    'Demon Slayer': { link: 'https://www.crunchyroll.com/es/series/GY5P48XEY/demon-slayer-kimetsu-no-yaiba' },
    'Solo Leveling': { link: 'https://www.crunchyroll.com/es/series/GMKUH8DZR/solo-leveling' },
    // Puedes seguir añadiendo los que quieras...
};

// ABRIR MODAL AL HACER CLIC EN CUALQUIER ANIME
document.addEventListener('click', function(e) {
    const box = e.target.closest('.box');
    if (!box) {
        document.getElementById('anime-modal').style.display = 'none';
        return;
    }

    e.preventDefault();
    const title = box.querySelector('h3').textContent.trim();
    const img = box.querySelector('img').src;
    const fullDesc = box.dataset.fullDesc || 'Disfruta de este anime en Crunchyroll.';

    // Buscar si tiene enlace personalizado
    const customLink = animeDB[title]?.link;

    // Rellenar modal
    document.getElementById('modal-img').src = img;
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-desc').textContent = fullDesc;

    // ENLACE "VER AHORA" → siempre lleva a Crunchyroll Discover (salvo que tenga personalizado)
    document.getElementById('modal-link').href = customLink || 'https://www.crunchyroll.com/es/discover';

    // Mostrar modal
    document.getElementById('anime-modal').style.display = 'flex';
});

// Cerrar al hacer clic fuera
document.getElementById('anime-modal').addEventListener('click', function(e) {
    if (e.target === this) this.style.display = 'none';
});
</script>